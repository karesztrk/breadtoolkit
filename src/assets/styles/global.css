@import url("./reset.css") layer(reset);
@import url("./fonts.css") layer(base);

@layer reset,
  base,
  typography,
  theme,
  components,
  utilities,
  animations,
  viewtransition,
  customproperty,
  scrollanimation;

:root {
  /* Typography */
  --font-family: "ET Book", Charter, "Bitstream Charter", "Sitka Text", Cambria, serif;
  --font-normal: 400;
  --font-bold: 700;

  /* 15px → 18px */
  --small-font-size: clamp(0.9377rem, 0.861rem + 0.341vw, 1.1253rem);
  /* 20px → 24px */
  --body-font-size: clamp(1.25rem, 1.1477rem + 0.4545vi, 1.5rem);

  /* Perfect Fourth */
  --type-ratio: 1.33;

  --font-size-6: calc(var(--body-font-size) * var(--type-ratio));
  --font-size-5: calc(var(--font-size-6) * var(--type-ratio));
  --font-size-4: calc(var(--font-size-5) * var(--type-ratio));
  --font-size-3: calc(var(--font-size-4) * var(--type-ratio));
  --font-size-2: calc(var(--font-size-3) * var(--type-ratio));
  --font-size-1: calc(var(--font-size-2) * var(--type-ratio));

  /* Space 3xs: 5px → 6px */
  --space-3xs: clamp(0.3125rem, 0.2869rem + 0.1136vw, 0.375rem);
  /* Space 2xs: 10px → 12px */
  --space-2xs: clamp(0.625rem, 0.5739rem + 0.2273vw, 0.75rem);
  /* Space xs: 15px → 18px */
  --space-xs: clamp(0.9375rem, 0.8608rem + 0.3409vw, 1.125rem);
  /* Space s: 20px → 24px */
  --space-s: clamp(1.25rem, 1.1477rem + 0.4545vw, 1.5rem);
  /* Space m: 30px → 36px */
  --space-m: clamp(1.875rem, 1.7216rem + 0.6818vw, 2.25rem);
  /* Space l: 40px → 48px */
  --space-l: clamp(2.5rem, 2.2955rem + 0.9091vw, 3rem);
  /* Space xl: 60px → 72px */
  --space-xl: clamp(3.75rem, 3.4432rem + 1.3636vw, 4.5rem);
  /* Space 2xl: 80px → 96px */
  --space-2xl: clamp(5rem, 4.5909rem + 1.8182vw, 6rem);
  /* Space 3xl: 120px → 144px */
  --space-3xl: clamp(7.5rem, 6.8864rem + 2.7273vw, 9rem);

  /* One-up pairs */
  /* Space 3xs-2xs: 5px → 12px */
  --space-3xs-2xs: clamp(0.3125rem, 0.1335rem + 0.7955vw, 0.75rem);
  /* Space 2xs-xs: 10px → 18px */
  --space-2xs-xs: clamp(0.625rem, 0.4205rem + 0.9091vw, 1.125rem);
  /* Space xs-s: 15px → 24px */
  --space-xs-s: clamp(0.9375rem, 0.7074rem + 1.0227vw, 1.5rem);
  /* Space s-m: 20px → 36px */
  --space-s-m: clamp(1.25rem, 0.8409rem + 1.8182vw, 2.25rem);
  /* Space m-l: 30px → 48px */
  --space-m-l: clamp(1.875rem, 1.4148rem + 2.0455vw, 3rem);
  /* Space l-xl: 40px → 72px */
  --space-l-xl: clamp(2.5rem, 1.6818rem + 3.6364vw, 4.5rem);
  /* Space xl-2xl: 60px → 96px */
  --space-xl-2xl: clamp(3.75rem, 2.8295rem + 4.0909vw, 6rem);
  /* Space 2xl-3xl: 80px → 144px */
  --space-2xl-3xl: clamp(5rem, 3.3636rem + 7.2727vw, 9rem);

  --leading: 1.4;
  --leading-short: 1.3;
  --leading-slim: 1.2;
  --leading-fine: 1.1;
  --leading-flat: 1;
  --leading-mini: 0.9;
  --leading-micro: 0.8;

  /* Layout */
  --gap: var(--space-s-m);
  --full: minmax(var(--gap), 1fr);
  --content: min(70ch, 100% - var(--gap) * 2);
  --popout-max: var(--space-m);
  --popout: minmax(0, var(--popout-max));
  --grid-row-nav: min-content;
}

@layer base {
  body {
    display: grid;
    grid-template-columns:
      [full-start] var(--full) [popout-start] var(--popout) [content-start] var(--content)
      [content-end] var(--popout) [popout-end] var(--full) [full-end];
    grid-template-rows: min-content;
  }

  body > :is(header, main, footer) {
    grid-column: content;
  }

  main {
    container: main / inline-size;
  }

  article > * + * {
    margin-block-start: var(--flow-space, 1em);
  }

  p,
  li,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    overflow-wrap: break-word;
    hyphens: auto;
  }

  nav,
  menu {
    display: flex;
    justify-content: space-between;
    margin: 0;
    padding: 0;
    gap: var(--space-xs);

    li {
      text-transform: capitalize;
    }
  }

  hr {
    margin-block: var(--space-l);
  }

  table {
    --stroke: 1px solid CanvasText;
    border: var(--stroke);
    border-collapse: collapse;
    width: 100%;

    th {
      text-align: left;
      font-weight: var(--font-bold);
      line-height: var(--leading-fine);
    }

    thead th {
      padding-block: var(--space-s);
    }

    td,
    th {
      padding: var(--space-xs) var(--space-s);
    }

    th:not(:only-of-type) {
      border-block-end: var(--stroke);
    }

    th:only-of-type {
      border-inline-end: var(--stroke);
    }

    :is(th, td) ~ :is(th, td) {
      border-inline-start: var(--stroke);
    }

    tr + tr :is(th, td) {
      border-block-start: var(--stroke);
    }

    caption {
      caption-side: bottom;
      margin-block-start: var(--space-s);
    }
  }

  dl {
    dt {
      font-weight: var(--font-bold);
    }

    dd {
      margin-inline-start: 1.5ch;
    }

    dt + dd {
      margin-block-start: var(--dd-space, 0.75em);
    }

    dd + dt {
      margin-block-start: var(--dt-space, 1em);
    }
  }

  ul:not([class]) {
    padding-inline-start: 2.5ch;
  }

  ol:not([class]) ::marker {
    font-size: 1em;
    font-weight: var(--font-bold);
  }

  :is(ol, ul):not([class]) li {
    margin-block-start: var(--flow-space, 0.75em);
  }
}

@layer typography {
  body {
    font-synthesis: none;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-family: var(--font-family);
    font-size: var(--body-font-size);
    font-variant-ligatures: common-ligatures no-discretionary-ligatures no-historical-ligatures
      contextual;
  }

  h1,
  h2,
  h3 {
    font-weight: var(--font-bold);
  }

  h4,
  h5,
  h6 {
    font-weight: var(--font-normal);
  }

  h1 {
    --font-size: var(--font-size-1);
    font-size: var(--font-size);
  }

  h2 {
    --font-size: var(--font-size-2);
    font-size: var(--font-size);
  }

  h3 {
    --font-size: var(--font-size-3);
    font-size: var(--font-size);
  }

  h4 {
    --font-size: var(--font-size-4);
    font-size: var(--font-size);
  }

  h5 {
    --font-size: var(--font-size-5);
    font-size: var(--font-size);
  }

  h6 {
    --font-size: var(--font-size-6);
    font-size: var(--font-size);
  }

  @supports (font-size: 1cqi) {
    :is(h1, h2, h3, h4, h5, h6) {
      --_font-min: calc(var(--font-size) - var(--font-size) * var(--font-size-diff, 0.3));

      /* https://moderncss.dev/container-query-units-and-fluid-typography/ */
      font-size: clamp(
        max(var(--body-font-size), var(--_font-min)),
        var(--_font-min) +
        1cqi,
        var(--font-size)
      );
    }
  }

  h1 {
    max-width: 20ch;
  }

  h2,
  h3 {
    max-width: 28ch;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    /* https://cloudfour.com/thinks/responsive-letter-spacing/ */
    letter-spacing: clamp(-0.01em, calc((1em - 1rem) / -10), 0em);
  }

  blockquote::before,
  q::before {
    content: open-quote;
  }

  blockquote::after,
  q::after {
    content: close-quote;
  }

  blockquote {
    max-width: 60ch;
    font-size: var(--font-size-6);

    p {
      display: inline;
    }

    footer,
    cite {
      font-size: var(--body-font-size);
    }

    &:has(footer):after {
      content: "";
    }
  }
}

@layer utilities {
  .visually-hidden {
    display: inline-block;
    position: absolute;
    overflow: hidden;
    clip: rect(0 0 0 0);
    height: 1;
    width: 1;
    margin: -1;
    padding: 0;
    border: 0;
  }
}
