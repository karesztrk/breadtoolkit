---
import Layout from "@layouts/Layout.astro";
import NumberInput from "@components/number-input/NumberInput.astro";
---

<Layout>
  <hgroup>
    <h1 id="title">Calculator</h1>
    <p id="description">Calculate your dough hydration and the amount of ingredients.</p>
  </hgroup>

  <calculator-view $input="onChange" $inputstep="onChange" $submit="onSubmit" aria-labelledby="title" aria-describedby="description">
    <article>
      <section>
        <dl>
          <dt>Dough weight</dt>
          <dd data-variant="emphasized"><span id="weight">...</span> gram</dd>

          <div>
            <dt data-variant="comment">Hydration</dt>
            <dd data-variant="comment"><span id="hydration">...</span> %</dd>
          </div>
        </dl>

        <details>
          <summary>Ingredient split</summary>
          <p>
            Check the ingredient ratios. We use <a href="https://en.wikipedia.org/wiki/Baker_percentage">baker's math</a> where every ingredient is calculated
            relative to the flour.
          </p>
          <dl>
            <div>
              <dt data-variant="comment">Flour</dt>
              <dd data-variant="comment"><span id="flour-percent" />%</dd>
            </div>
            <div>
              <dt data-variant="comment">Water</dt>
              <dd data-variant="comment"><span id="water-percent" />%</dd>
            </div>
            <div>
              <dt data-variant="comment">Salt</dt>
              <dd data-variant="comment"><span id="salt-percent" />%</dd>
            </div>
            <div>
              <dt data-variant="comment">Sourdough</dt>
              <dd data-variant="comment"><span id="sourdough-percent" />%</dd>
            </div>
          </dl>
        </details>

        <button popovertarget="weight-popover">Custom weight</button>
      </section>

      <div id="weight-popover" popover="auto">
        <form id="weight-form">
          <div>
            <label for="weight-input">Dough weight</label>
            <input id="weight-input" type="number" name="weight" inputmode="decimal" step="1" min="0" required aria-describedby="weight-hint" />
            <small id="weight-helper">Set the target dough weight</small>
          </div>
          <input type="submit" value="Confirm" />
        </form>
      </div>

      <section>

        <form aria-labelledby="title">
          <calculator-form-group $input="onInput">
            <label for="flour-input">Flour</label>
            <NumberInput type="number" id="flour-input" name="flour" value="0" inputmode="decimal" step="1" min="0" required enterkeyhint="next" />
          </calculator-form-group>

          <calculator-form-group $input="onInput">
            <label for="water-input">Water</label>
            <NumberInput type="number" id="water-input" name="water" value="0" inputmode="decimal" step="1" min="0" required enterkeyhint="next">
          </calculator-form-group>

          <calculator-form-group $input="onInput">
            <label for="salt-input">Salt</label>
            <NumberInput type="number" id="salt-input" name="salt" value="0" inputmode="decimal" step="1" min="0" required enterkeyhint="next">
          </calculator-form-group>

          <calculator-form-group $input="onInput">
            <label for="sourdough-input">Sourdough</label>
            <NumberInput type="number" id="sourdough-input" name="sourdough" value="0" inputmode="decimal" step="1" min="0" required enterkeyhint="next">
          </calculator-form-group>

          <div>
            <label for="sourdough-ratio-input">Sourdough ratio</label>
            <input type="range" value="0" step="1" min="0" max="100" id="sourdough-ratio-input" name="sourdough_ratio" required list="ratio-values" />
            <datalist id="ratio-values">
              <option value="0" label="0"></option>
              <option value="10" label="10"></option>
              <option value="20"></option>
              <option value="30"></option>
              <option value="40"></option>
              <option value="50"></option>
              <option value="60"></option>
              <option value="70"></option>
              <option value="80"></option>
              <option value="90"></option>
              <option value="100"></option>
            </datalist>
          </div>
        </form>

        <details>
          <summary>How does the <dfn>hydration</dfn> calculated?</summary>
          <p>The <dfn>hydratation</dfn> is based on the ratio between the whole flour and whole the liquid. Both the sourdough and the extra ingredients affect the liquid content.</p>
        </details>
      </section>

    </article>
  </calculator-view>
</Layout>


<script>
  import "@components/calculator/CalculatorView";
  import "@components/calculator/CalculatorFormGroup";
  import "@components/calculator/CalculatorFormGroup";

  const supportsPopover = () => {
    return Object.hasOwn(HTMLElement.prototype, "popover");
  }
  console.log("Supports popover: " + supportsPopover());
</script>

<style>
  calculator-view,
  calculator-form-group {
    display: block;
  }
</style>
